import{q as e,E as t,s as a,v as l,u as o,r as n,c as s,J as r,o as u,d as i,w as c,f as d,N as m,j as _,t as p,C as v,g as f,h as k,i as g,F as h,K as b,O as y,k as x,l as F,P as j,x as w,B as C,z as S,_ as T}from"./index-CTwYRwII.js";import{_ as I}from"./uv-tabs.Dq0PohaD.js";import{S as N,N as $,_ as E}from"./NotError.CJ6ESAIE.js";import{_ as M}from"./uv-button.uPK3ECrp.js";import{u as V}from"./user.oiq89cpE.js";import"./uv-line-progress.B4ZfL6EO.js";import"./date.B8FaB0HV.js";import"./uv-loading-icon.pAx59lDh.js";const A=T(e({__name:"taskCenter",setup(e){const T=t((()=>(q.value.reduce(((e,t)=>e+({[l.t("component.order.3")]:R.value.like_amount,[l.t("component.order.4")]:R.value.share_amount,[l.t("component.order.5")]:R.value.forward_amount,[l.t("component.order.6")]:R.value.favorite_amount}[t.title]||0)*t.num),0)||0).toFixed(2))),A=a("R"),B=a({lineColor:"#FF2442",activeStyle:{color:"#FF2442"},inactiveStyle:{color:"#4B5563"},list:[{name:l.t("page.task.1")},{name:l.t("component.order.1"),disabled:!0},{name:l.t("component.order.2"),disabled:!0}],lineWidth:"100",lineHeight:"2",current:0,scrollable:!1}),D=a([{id:1,icon:"../../static/task/praise.png",title:l.t("component.order.3"),teskTitle:l.t("component.order.7"),num:0},{id:2,icon:"../../static/task/forwarding.png",title:l.t("component.order.4"),teskTitle:l.t("component.order.8"),num:0},{id:3,icon:"../../static/task/concern.png",title:l.t("component.order.5"),teskTitle:l.t("component.order.9"),num:0},{id:4,icon:"../../static/task/star.png",title:l.t("component.order.6"),teskTitle:l.t("component.order.10"),num:0}]),J=(e=8)=>{const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.from({length:e}).map((()=>t.charAt(Math.floor(Math.random()*t.length)))).join("")},O=a(Array.from({length:8}).map(((e,t)=>({id:t+1,icon:`/static/task/avatar${t+1}.jpg`,name:J(8)})))),U=V(),q=a([]),P=a([]),R=a({period_number:"",start_time:"",end_time:"",status:"",is_expired:!1,remaining_time:0,like_amount:0,share_amount:0,forward_amount:0,favorite_amount:0}),W=a(""),z=({index:e})=>{0===e?B.value.current=e:b({url:"/pages/order/order?type="+e})},H=(e,t)=>{const a=e.value.findIndex((e=>JSON.stringify(e)===JSON.stringify(t)));-1===a?e.value.push(t):e.value.splice(a,1)},K=t((()=>{const e={};return D.value.forEach((t=>{switch(t.id){case 1:e[t.title]="like_count";break;case 2:e[t.title]="share_count";break;case 3:e[t.title]="follow_count";break;case 4:e[t.title]="favorite_count"}})),e})),L=()=>{var e;const t={amount:Number(T.value),profit_amount:90,like_count:0,share_count:0,follow_count:0,favorite_count:0,period_number:(null==(e=null==R?void 0:R.value)?void 0:e.period_number)??""};q.value.forEach((e=>{const a=K.value[e.title];a&&(t[a]=e.num)}));["like_count","share_count","follow_count","favorite_count"].every((e=>""!==t[e])),l.service.order$create(t).then((e=>{e.success(((e,t)=>{y({title:l.t("other.3"),icon:"none"})}))}))},G=()=>{U.user.has_group_buy_qualification&&W.value?l.dialogFun(N,{}):l.dialogFun($,{})},Q=a(0);let X;const Y=e=>{const t=Date.now(),a=new Date(e).getTime(),l=Math.floor((a-t)/1e3);Q.value=l>0?l:0,Q.value>0&&(X&&clearInterval(X),X=setInterval((()=>{Q.value>0?Q.value--:(clearInterval(X),Z())}),1e3))},Z=()=>{try{l.service.order$period({}).then((e=>e.success((e=>{R.value=e,Y(e.end_time)}))))}catch(e){console.error("刷新失败",e)}};return o((()=>{Z(),l.service.groupBuy$activeDetail({}).then((e=>{e.success((e=>{W.value=e.has_data}))})),U.fetchUserInfo(),l.service.currency$current({}).then((e=>{e.success((e=>{A.value=(null==e?void 0:e.symbol)||"R"}))}))})),(e,t)=>{const a=n(s("uv-tabs"),I),o=x,b=F,y=S,N=n(s("uv-number-box"),E),$=n(s("uv-button"),M),V=j,J=r("bt-page");return u(),i(J,{backIcon:"",navText:v(l).t("page.index.4"),padding:32},{default:c((()=>[d(o,{class:"task content"},{default:c((()=>[d(o,{class:"head"},{default:c((()=>[d(a,m(B.value,{onClick:z}),null,16)])),_:1}),0==B.value.current?(u(),i(V,{key:0,"scroll-y":"",class:"body body0 animate__animated animate__fadeInLeft"},{default:c((()=>[d(o,{class:"title"},{default:c((()=>[d(o,null,{default:c((()=>[d(b,null,{default:c((()=>[_(p(v(l).t("page.order.3"))+":",1)])),_:1}),R.value.period_number?(u(),i(b,{key:0},{default:c((()=>[_("["+p(R.value.period_number)+"]",1)])),_:1})):f("",!0)])),_:1}),d(o,null,{default:c((()=>[d(b,null,{default:c((()=>[_(p(v(l).t("page.task.3"))+":",1)])),_:1}),d(b,null,{default:c((()=>{return[_(p((e=Q.value,`00:${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`)),1)];var e})),_:1})])),_:1})])),_:1}),d(o,{class:"subTitle"},{default:c((()=>[_(p(v(l).t("page.task.4")),1)])),_:1}),d(o,{class:"type"},{default:c((()=>[(u(!0),k(h,null,g(D.value,((e,t)=>(u(),i(o,{class:w(["item",q.value.some((t=>t.id===e.id))?"select":""]),key:t,onClick:t=>{H(q,e)}},{default:c((()=>[d(o,null,{default:c((()=>[d(y,{src:e.icon,mode:"aspectFill"},null,8,["src"])])),_:2},1024),C("p",null,p(e.title),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),d(o,{class:"avatar"},{default:c((()=>[(u(!0),k(h,null,g(O.value,((e,t)=>(u(),i(o,{class:w(["item",P.value.some((t=>t.id===e.id))?"select":""]),key:t,onClick:t=>{H(P,e)}},{default:c((()=>[d(o,null,{default:c((()=>[d(y,{src:e.icon,mode:"aspectFill"},null,8,["src"])])),_:2},1024),C("p",null,p(e.name),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),(u(!0),k(h,null,g(q.value,((e,t)=>(u(),i(o,{class:"task-detail",key:t},{default:c((()=>[d(o,{class:"left"},{default:c((()=>[_(p(e.teskTitle),1)])),_:2},1024),d(N,{modelValue:e.num,"onUpdate:modelValue":t=>e.num=t,min:0,integer:"",inputWidth:50},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)))),128)),d(o,{class:"totalPrice"},{default:c((()=>[d(o,{class:"left"},{default:c((()=>[_(p(v(l).t("page.task.5")),1)])),_:1}),d(o,null,{default:c((()=>[_(p(A.value)+" "+p(T.value),1)])),_:1})])),_:1}),d(o,{class:"together"},{default:c((()=>[d($,{text:v(l).t("page.task.6"),color:"#FF0036",onClick:G},null,8,["text"])])),_:1}),d(o,{class:"buy"},{default:c((()=>[d($,{text:v(l).t("page.task.7"),color:"#FF0036",onClick:L},null,8,["text"])])),_:1})])),_:1})):f("",!0)])),_:1})])),_:1},8,["navText"])}}}),[["__scopeId","data-v-b0581693"]]);export{A as default};
